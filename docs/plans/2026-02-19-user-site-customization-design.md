# 유저 사이트 커스텀 작업 계획서 v1.0

> **작성일**: 2026-02-19
> **작성자**: 앤트로픽 시니어 개발 총괄
> **원본**: `~/Desktop/casino/` (Laravel 12 + Next.js 15)
> **작업 대상**: `user-site/` (관리자페이지 하위)
> **전략**: 완전 분리 — 독립 DB, 독립 백엔드, 독립 배포

---

## 0. 아키텍처 결정 사항

```
┌─────────────────────┐     ┌─────────────────────┐
│   관리자 패널         │     │   유저 사이트          │
│   (Admin Panel)      │     │   (User Site)        │
├─────────────────────┤     ├─────────────────────┤
│ Frontend: Next.js 16 │     │ Frontend: Next.js 15 │
│ Backend:  FastAPI    │     │ Backend:  Laravel 12 │
│ DB: PostgreSQL:5433  │     │ DB: PostgreSQL:5434  │
│ Port: 8002/3001      │     │ Port: 8003/3002      │
└─────────┬───────────┘     └─────────┬───────────┘
          │                           │
          └───── 독립 운영 (DB 분리) ──┘
```

### 핵심 원칙
- **DB 완전 분리**: user-site 전용 PostgreSQL (포트 5434)
- **코드 독립**: 관리자 패널 코드 수정 없음
- **단계적 진행**: 각 Phase 완료 후 검증 → CLAUDE.md 업데이트
- **중단 대비**: 각 Phase 체크포인트 기록, 재개 가능

---

## 1. Phase 구성 (총 8 Phase)

| Phase | 작업 | 예상 규모 | 우선순위 | 에이전트 배정 |
|-------|------|-----------|----------|---------------|
| **P0** | 환경 설정 + DB 초기화 | 소 | P0 필수 | 인프라 1명 |
| **P1** | 브랜딩 + 한국어 커스텀 | 중 | P0 필수 | 프론트 2명 |
| **P2** | 인증 시스템 커스텀 | 중 | P0 필수 | 풀스택 2명 |
| **P3** | 게임 연동 설정 | 대 | P1 핵심 | 백엔드 2명 |
| **P4** | 입출금 커스텀 | 대 | P1 핵심 | 풀스택 2명 |
| **P5** | 커미션/어필리에이트 커스텀 | 중 | P2 중요 | 백엔드 1명 |
| **P6** | 프로모션/VIP/미션 커스텀 | 중 | P2 중요 | 풀스택 2명 |
| **P7** | 배포 + 통합 테스트 | 중 | P3 마무리 | 인프라+QA 2명 |

---

## 2. Phase 0: 환경 설정 + DB 초기화

### 목표
user-site가 독립적으로 실행되는 개발 환경 구축

### 작업 목록
- [ ] `user-site/docker-compose.yml` 수정 — PostgreSQL 포트 5434, Redis 포트 6380
- [ ] `user-site/backend/.env` 생성 — DB_PORT=5434, APP_PORT=8003, FRONTEND_URL
- [ ] `user-site/frontend/.env.local` 생성 — NEXT_PUBLIC_API_URL=http://localhost:8003/api
- [ ] Docker Compose로 DB + Redis 기동
- [ ] `php artisan migrate` 실행 — 23개 마이그레이션
- [ ] `php artisan db:seed` 실행 — 시드 데이터
- [ ] `composer install` — PHP 의존성
- [ ] `npm install` — 프론트엔드 의존성
- [ ] Backend 기동 확인 (http://localhost:8003)
- [ ] Frontend 기동 확인 (http://localhost:3002)
- [ ] Filament Admin 접속 확인 (http://localhost:8003/admin)

### 검증 체크리스트
- [ ] DB 테이블 40+ 생성 확인
- [ ] Backend health check 200 OK
- [ ] Frontend 랜딩 페이지 렌더링
- [ ] ✅ CLAUDE.md 업데이트: Phase 0 완료

---

## 3. Phase 1: 브랜딩 + 한국어 커스텀

### 목표
사이트 브랜딩 변경, 한국어 UI 검수 및 수정

### 작업 목록
- [x] 사이트명/로고 확인 — KZ 유지 (layout.tsx, Header, Footer 모두 한국어)
- [x] 컬러 테마 확인 — 황금색(#feb614) 유지
- [x] Tailwind 테마 확인 — 기존 설정 유지
- [x] 한국어 텍스트 검수 — 전체 49개 .tsx 파일 전수 조사, 99%+ 한국어 완료
- [x] 미번역 영어 텍스트 — 고유명사(브랜드, 게임명) 외 영문 없음
- [x] 통화 단위 통일 — ₩ KRW 유지 (formatCurrency ko-KR 설정 확인)
- [x] Favicon, OG 이미지, meta 태그 확인 — KZ 브랜딩 적용됨
- [x] Footer 링크 수정 — 이용약관/개인정보처리방침/책임감있는게임 링크 추가
- [x] Footer 결제수단 정리 — UPI/GPay 제거, Bitcoin/Crypto만 유지
- [x] Footer 통화 정리 — 다국적 통화 제거, KRW만 유지
- [x] 이용약관 페이지 생성 — /terms
- [x] 개인정보처리방침 페이지 생성 — /privacy
- [x] 책임감 있는 게임 페이지 생성 — /responsible-gaming

### 시니어 개발자 추가 제안 (후속 작업)
- [ ] **다크모드 기본값 설정**: globals.css에서 dark 테마를 기본으로
- [ ] **PWA 매니페스트 추가**: 모바일 홈 화면 추가 지원
- [ ] **로딩 스켈레톤 통일**: 각 페이지에 일관된 로딩 UX

### 검증 체크리스트
- [x] 모든 페이지 한국어 표시 확인
- [x] 브랜딩 일관성 검수 (Header/Footer/Title)
- [x] 빌드 성공 확인 (next build --webpack)
- [x] ✅ CLAUDE.md 업데이트: Phase 1 완료

---

## 4. Phase 2: 인증 시스템 커스텀

### 목표
한국 시장에 맞는 인증 플로우 구성

### 작업 목록
- [x] 회원가입 폼 수정 — username(아이디, 영문소문자+숫자 4~20), nickname, phone(01XXXXXXXXX) 기반
- [x] 로그인 방식 — 아이디(login_id)+비밀번호 (이메일 완전 제거)
- [x] 추천인 코드 입력 필드 강화 — 필수 입력으로 변경
- [x] 소셜 로그인 설정 — Telegram만 유지, Google/Facebook/Twitter/WhatsApp/Line 제거
- [x] 비밀번호 정책 — 최소 8자, 영문+숫자 (대소문자 강제 제거, 한국 관행)
- [x] Sanctum 토큰 TTL — 24시간 유지 (쿠키 기반, 적절)
- [x] IP 기반 접속 제한 — CheckIpBlacklist 미들웨어 API 그룹에 활성화
- [x] UserResource 업데이트 — name/last_name → username/nickname 반환
- [x] 프로필 페이지 — 아이디/닉네임/전화번호 표시로 변경
- [x] Validation 메시지 — 한국어 전면 적용 (로그인 5개, 회원가입 15개)
- [x] 프론트엔드 빌드 성공 확인

### 시니어 개발자 추가 제안 (후속 작업)
- [ ] **출금 비밀번호 분리**: 로그인 비밀번호와 별도 출금 전용 비밀번호
- [ ] **기기 바인딩**: 최초 로그인 기기 기록, 새 기기 로그인 시 알림
- [ ] **로그인 알림 텔레그램**: 로그인 시 관리자에게 자동 알림

### 검증 체크리스트
- [x] 프론트엔드 빌드 성공 (next build --webpack)
- [x] 백엔드-프론트엔드 API 정합성 확인
- [x] user.name 참조 전체 제거 확인 (grep 검증)
- [x] ✅ CLAUDE.md 업데이트: Phase 2 완료

---

## 5. Phase 3: 게임 연동 설정

### 목표
게임 프로바이더 API 연동 및 게임 로비 구성

### 작업 목록
- [x] 게임 프로바이더 API 키 설정 — `config/game-providers.php` (8개 프로바이더 등록 완료)
- [x] 프로바이더별 활성화/비활성화 — Filament Admin GameResource, ProviderResource 한국어화 완료
- [x] 게임 카테고리 구성 — 7종목 시드 데이터 (GameCategorySeeder.php)
- [x] 게임 프로바이더 시드 — 10개 주요 프로바이더 (GameProviderSeeder.php)
- [x] 게임 런치 URL 생성 — 언어 기본값 ko, 팝업(window.open) 방식
- [x] 게임 결과 웹훅 수신 — 8개 프로바이더 전체 라우트 확장
- [x] 잔액 콜백 API — `POST /api/game-callback/balance` 신규 엔드포인트
- [x] 게임 즐겨찾기 기능 검증 — 토글 + 즐겨찾기 목록 API 연동 완료
- [x] 게임 검색/필터 기능 검증 — 카테고리/프로바이더/검색 필터 동작
- [x] 에러 메시지 한국어화 — GameController, GameProviderService, 프로바이더 20+건
- [x] 게임 상세 API 라우트 추가 — `GET /api/games/{game}` (누락 수정)
- [ ] 게임 목록 자동 수집 — `php artisan games:fetch` (프로바이더 API 키 확보 후 진행)
- [ ] 게임 썸네일 다운로드/관리 — (프로바이더 API 키 확보 후 진행)

### 시니어 개발자 추가 제안
- [x] **게임 점검 모드**: 프로바이더/게임 비활성 시 "점검 중" 오버레이 + 클릭 차단
- [x] **최근 플레이 게임**: localStorage 영속화, 최대 10개, 게임 로비 상단 표시
- [x] **인기 게임 자동 정렬**: views 기반 정렬 (기존 구현 확인, Redis INCR 캐시)

### 검증 체크리스트
- [x] 게임 목록 페이지 로딩 (프론트엔드 빌드 성공)
- [x] 게임 런치 흐름 (코드 검증 — 테스트 모드, API 키 없이는 실제 런치 불가)
- [x] 잔액 콜백 엔드포인트 추가 완료
- [x] ✅ CLAUDE.md 업데이트: Phase 3 완료

---

## 6. Phase 4: 입출금 커스텀

### 목표
암호화폐 전용 입출금 시스템 구성 (관리자 패널과 동일 정책)

### 작업 목록
- [ ] 결제 게이트웨이 설정 — USDT(TRC20/ERC20/BEP20) 중심
- [ ] 입금 프로세스 — 지갑 주소 표시 → TX 확인 → 잔액 반영
- [ ] 출금 프로세스 — 출금 신청 → 관리자 승인 → 전송
- [ ] 최소/최대 입출금 한도 설정
- [ ] 수수료 설정 (입금 0%, 출금 수수료 비율)
- [ ] TX Hash 조회/검증 로직
- [ ] 출금 주소 화이트리스트 — `WithdrawalAddress` 관리
- [ ] 결제 웹훅 수신 — `WebhookController`
- [ ] 거래 내역 페이지 검증

### 시니어 개발자 추가 제안
- [ ] **입금 자동 감지**: 블록체인 TX 모니터링으로 자동 입금 확인
- [ ] **대규모 거래 알림**: 설정 금액 초과 시 텔레그램 알림
- [ ] **출금 쿨타임**: 연속 출금 방지 (최소 간격 설정)
- [ ] **일일 출금 한도**: 유저 레벨별 일일 출금 상한

### 검증 체크리스트
- [ ] 입금 주소 생성/표시
- [ ] 출금 신청 → 관리자 승인 플로우
- [ ] 거래 내역 정상 표시
- [ ] ✅ CLAUDE.md 업데이트: Phase 4 완료

---

## 7. Phase 5: 커미션/어필리에이트 커스텀

### 목표
추천인 시스템과 커미션 분배 로직 한국 시장 맞춤

### 작업 목록
- [ ] 추천인 코드 시스템 검증 — 가입 시 자동 연결
- [ ] 커미션 정책 설정 — 롤링(베팅%), 죽장(손실%) 택1
- [ ] 3단계 어필리에이트 트리 검증
- [ ] 커미션 자동 정산 주기 설정
- [ ] 어필리에이트 대시보드 — 수익, 하부 회원, 통계
- [ ] 커미션 출금 신청 기능

### 시니어 개발자 추가 제안
- [ ] **실시간 커미션 알림**: 커미션 발생 시 유저에게 즉시 알림
- [ ] **하부 회원 활동 모니터링**: 추천한 회원의 최근 활동 요약
- [ ] **커미션 시뮬레이터**: 예상 수익 계산기 (마케팅용)

### 검증 체크리스트
- [ ] 추천 코드로 가입 → 트리 연결 확인
- [ ] 베팅 시 커미션 자동 계산
- [ ] 어필리에이트 대시보드 데이터 정확성
- [ ] ✅ CLAUDE.md 업데이트: Phase 5 완료

---

## 8. Phase 6: 프로모션/VIP/미션 커스텀

### 목표
보상 시스템 한국어 커스텀 및 비즈니스 로직 조정

### 작업 목록
- [ ] VIP 레벨 구성 — 등급명, 혜택, 승급 조건 한국어화
- [ ] 미션 시스템 — 일일/주간 미션 구성
- [ ] 출석 체크 보상 설정
- [ ] 룰렛(스핀 휠) 상품 구성
- [ ] 입금 보너스 설정 — 첫 입금, 재입금 보너스
- [ ] 프로모션 배너 관리 — Filament Admin
- [ ] 팝업 공지 시스템 — 이벤트, 점검 알림

### 시니어 개발자 추가 제안
- [ ] **첫 충전 보너스 자동 지급**: 첫 입금 시 N% 자동 보너스
- [ ] **컴프(comp) 포인트**: 베팅량 기반 자동 포인트 적립
- [ ] **쿠폰 시스템**: 관리자가 발행하는 쿠폰 코드 (입금보너스/무료스핀)
- [ ] **생일 보너스**: 유저 생일에 자동 보너스 지급

### 검증 체크리스트
- [ ] VIP 레벨 표시 및 혜택
- [ ] 미션 진행/완료/보상 수령
- [ ] 출석 체크 정상 동작
- [ ] ✅ CLAUDE.md 업데이트: Phase 6 완료

---

## 9. Phase 7: 배포 + 통합 테스트

### 목표
프로덕션 배포 준비 및 전체 E2E 검증

### 작업 목록
- [ ] docker-compose.prod.yml 수정 — 프로덕션 설정
- [ ] Nginx 리버스 프록시 설정
- [ ] SSL 인증서 설정 (Let's Encrypt)
- [ ] .env.production 환경 변수 구성
- [ ] PHP-FPM 성능 튜닝
- [ ] Redis 캐시 전략 설정
- [ ] 전체 E2E 시나리오 테스트 (아래 참조)
- [ ] 보안 점검 — OWASP Top 10 체크
- [ ] 성능 테스트 — 동시 접속 시뮬레이션
- [ ] 백업 전략 수립

### E2E 테스트 시나리오
1. 회원가입 (추천코드 포함) → 로그인
2. 입금 신청 → 잔액 확인
3. 게임 접속 → 베팅 → 결과 확인
4. 커미션 발생 → 추천인 확인
5. 출금 신청 → 관리자 승인 (Filament)
6. VIP 레벨 확인 → 미션 수행
7. 출석 체크 → 보상 수령
8. 문의하기 → 답변 확인

### 시니어 개발자 추가 제안
- [ ] **헬스체크 엔드포인트**: `/health` API — 모니터링 시스템 연동
- [ ] **에러 트래킹**: Sentry 또는 자체 에러 로깅
- [ ] **CDN 설정**: 정적 자산 CDN 배포 (이미지, CSS, JS)
- [ ] **DB 자동 백업**: 일일 pg_dump + S3 업로드

### 검증 체크리스트
- [ ] E2E 8개 시나리오 전부 통과
- [ ] 프로덕션 빌드 정상
- [ ] SSL 인증서 유효
- [ ] ✅ CLAUDE.md 업데이트: Phase 7 완료 → 전체 완료

---

## 10. 에이전트 팀 구성 (teammate_mode: tmux)

각 Phase에서 Opus 4.6 에이전트 팀을 활용:

```
Team Lead (나) ─── 총괄, 검증, CLAUDE.md 업데이트
  ├── Agent-1: 인프라/DevOps ─── Docker, DB, 배포
  ├── Agent-2: 프론트엔드 ─── UI, 브랜딩, 한국어화
  ├── Agent-3: 백엔드 ─── API, 비즈니스 로직
  └── Agent-4: QA ─── 검증, 테스트
```

### 병렬 작업 가능 구간
- P0: 순차 (환경 설정 먼저)
- P1+P2: 병렬 가능 (브랜딩 ∥ 인증)
- P3+P4: 병렬 가능 (게임 ∥ 입출금)
- P5+P6: 병렬 가능 (커미션 ∥ 프로모션)
- P7: 순차 (통합 테스트)

---

## 11. 중단 대비 프로토콜

### 각 Phase 완료 시 필수 수행
1. ✅ 검증 체크리스트 모든 항목 통과
2. ✅ CLAUDE.md의 user-site 섹션 업데이트 (현재 Phase, 완료 항목)
3. ✅ `docs/plans/2026-02-19-user-site-customization-design.md` 해당 Phase 체크 (⬜→✅)
4. ✅ git commit으로 체크포인트 생성

### 재개 시 절차
1. CLAUDE.md에서 현재 상태 확인
2. 이 문서에서 마지막 완료 Phase 확인
3. 미완료 작업부터 이어서 진행

---

## 12. 시니어 개발자 종합 의견

### 반드시 추가해야 할 기능 (사업적 필수)
1. **출금 비밀번호**: 보안 필수 — 베팅 사이트의 기본 기능
2. **텔레그램 알림 연동**: 입출금/대규모 거래 실시간 모니터링
3. **IP 차단/관리**: 다중 계정 방지, 해외 접속 차단
4. **베팅 한도 설정**: 유저별 일일/월간 베팅 상한

### 있으면 차별화되는 기능 (경쟁력)
1. **실시간 채팅**: 고객 지원 + 유저간 소통
2. **모바일 앱 래핑**: PWA → 앱스토어 없이 홈 화면 설치
3. **다국어 지원**: 한국어 기본 + 영어/중국어 옵션
4. **AI 고객 지원**: FAQ 자동 응답 챗봇

### 주의사항
- Laravel Filament 어드민은 **유저 사이트 관리 전용**으로 사용
- 관리자 패널(FastAPI)과 역할이 겹치지 않도록 명확히 분리
- 게임 프로바이더 API 키가 없으면 P3는 테스트 모드로만 진행 가능
- 결제 게이트웨이도 API 키 필요 — 사전 준비 필수

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|-----------|
| 2026-02-19 | v1.0 | 최초 작성 — 8 Phase 계획 + 에이전트 팀 구성 |
