# 회원 상세정보 강화 작업 계획서 v2

> **작성일**: 2026-02-18
> **기능**: 회원 상세 페이지 전면 리뉴얼 (8탭 구조)
> **우선순위**: P0 (핵심 기능)

---

## 1. 공통 헤더 (Common Header)

- **표시**: 아이디, 상태, 닉네임, 레벨
- **액션 버튼**: 수정, 비밀번호 초기화, 비밀번호 지정, 정지

## 2. 8탭 구조

### Tab 1: 기본 정보 (General)
- 보유 자산: 잔액, 포인트
- 누적 통계: 총 입금액, 총 출금액
- 게임별 롤링율(%): 카지노, 슬롯, 홀덤, 스포츠, 슈팅, 코인, 미니게임
- 홀덤 상세(Provider): 레볼루션, 스카이시티, 와일드
- 베팅 권한 설정: 종목별 허용/차단 스위치
- 누락(공베팅) 설정: N회 베팅마다 1회 누락 (하위 상속)
- 신상 정보: 가입일, 최근접속, 연락처, 색상, 출금 계좌, 가상계좌
- 관리자 메모란

### Tab 2: 베팅 (Betting)
- 요약: 총 베팅, 총 당첨액, 손익(입금-출금)
- 필터: 게임 종류별, 기간별(오늘/어제/7일/30일/달력)
- 목록: 베팅 상세 내역 리스트

### Tab 3: 머니 (Money)
- 요약: 현재 잔액, 총 지급(+), 총 회수(-)
- 필터: 거래 유형별, 기간별
- 목록: 머니 변동 이력 리스트

### Tab 4: 포인트 (Point)
- 요약: 현재 포인트, 총 지급(+), 총 회수/사용(-)
- 필터: 유형별(지급/회수/롤링/루징/전환/출석/이벤트), 기간별
- 목록: 포인트 변동 이력 리스트

### Tab 5: 입출금 (Transaction)
- 입금 신청 내역, 출금 신청 내역
- 승인/대기/취소 상태값

### Tab 6: 문의내역 (CS)
- 요약: 전체 건수, 미답변, 답변완료
- 필터: 답변 상태별, 기간별
- 목록: 제목, 등록일, 답변 상태

### Tab 7: 추천코드 (Referral)
- 본인 추천인 코드, 하부 회원 수
- 추천인 수익 롤링/루징 설정

### Tab 8: 쪽지 (Message)
- [쪽지 보내기] 버튼
- 발송/수신 쪽지 내역 (제목, 일시, 읽음 상태)

---

## 3. 작업 단계 (8 Steps)

### Step 1: DB 모델 + 마이그레이션 ✅ (2026-02-18 완료)
- User 모델 확장 (nickname, color, password_hash, registration_ip, 통계 캐시)
- UserLoginHistory 모델 (IP, UA, 기기, OS, 브라우저)
- UserBankAccount 모델 (은행, 계좌, 예금주, 가상계좌)
- UserBettingPermission 모델 (종목별 허용/차단)
- UserNullBettingConfig 모델 (공베팅 설정)
- UserGameRollingRate 모델 (게임별 롤링율)
- BetRecord 모델 (베팅 기록)
- MoneyLog 모델 (머니 변동)
- PointLog 모델 (포인트 변동)
- Inquiry 모델 (문의)
- Message 모델 (쪽지)
- Alembic 마이그레이션 실행
- **검증**: DB 테이블 생성 확인

### Step 2: 백엔드 API - 기본 정보 + 통계 ✅ (2026-02-18 완료)
- GET /users/{id}/detail (통합 상세)
- GET /users/{id}/statistics (입출금/베팅 통계)
- Bank account CRUD (4 endpoints)
- 베팅 권한 CRUD
- 공베팅 설정 CRUD
- 게임별 롤링율 CRUD
- 비밀번호 초기화/지정 API
- 회원 정지 API
- **검증**: Swagger + curl 테스트

### Step 3: 백엔드 API - 이력 탭들 ✅ (2026-02-18 완료)
- GET /users/{id}/bets (베팅 내역 + 필터)
- GET /users/{id}/money-logs (머니 변동 + 필터)
- GET /users/{id}/point-logs (포인트 변동 + 필터)
- GET /users/{id}/login-history (로그인 이력)
- Inquiry CRUD (문의 등록/목록/답변)
- Message CRUD (쪽지 발송/목록/읽음처리)
- 로그인 시 자동 기록 미들웨어
- **검증**: 모든 API 호출 테스트

### Step 4: 프론트엔드 - 공통 헤더 + 탭 골격 ✅ (2026-02-18 완료)
- 공통 헤더 (아이디/상태/닉네임/레벨 + 액션 버튼)
- 8탭 구조 레이아웃
- 각 탭 빈 컴포넌트 scaffolding
- **검증**: 페이지 렌더링 + 탭 전환

### Step 5: 프론트엔드 - Tab 1 기본 정보 ✅ (2026-02-18 완료)
- 보유 자산 카드 (잔액/포인트)
- 누적 통계 (총 입금/출금)
- 게임별 롤링율 테이블 + 편집
- 베팅 권한 스위치
- 공베팅 설정
- 신상 정보 + 계좌 정보
- 메모란
- **검증**: 데이터 표시 + 수정 동작

### Step 6: 프론트엔드 - Tab 2~5 (베팅/머니/포인트/입출금) ✅ (2026-02-18 완료)
- 각 탭 요약 카드 + 필터 + 페이지네이션 리스트
- 기간 필터 (오늘/어제/7일/30일/달력)
- 빈 데이터 안내 문구
- **검증**: 필터 + 페이지네이션 동작

### Step 7: 프론트엔드 - Tab 6~8 (문의/추천/쪽지) ✅ (2026-02-18 완료)
- 문의: 요약 + 상태별 필터 + 목록
- 추천: 추천코드 + 하부 회원 수 + 롤링/루징 설정
- 쪽지: 보내기 버튼 + 발송/수신 목록
- **검증**: 전체 CRUD 동작

### Step 8: 통합 검증 + CLAUDE.md 인수인계 ✅ (2026-02-18 완료)
- 전체 E2E 시나리오 테스트
- 시드 데이터 검증
- Frontend 빌드 성공 확인
- CLAUDE.md 업데이트
- 인수인계 문서 작성
- **검증**: 서비스 재시작 후 전체 동작

---

## 4. 신규 테이블 목록 (11개)

| 테이블 | 설명 |
|--------|------|
| user_login_history | 로그인 기록 (IP/UA/기기) |
| user_bank_accounts | 출금 계좌 정보 |
| user_betting_permissions | 종목별 베팅 허용/차단 |
| user_null_betting_configs | 공베팅(누락) 설정 |
| user_game_rolling_rates | 게임별 롤링율 |
| bet_records | 베팅 상세 기록 |
| money_logs | 머니 변동 이력 |
| point_logs | 포인트 변동 이력 |
| inquiries | 문의 내역 |
| inquiry_replies | 문의 답변 |
| messages | 쪽지 |

## 5. User 모델 확장 필드

```
nickname            -- 닉네임
color               -- 색상 (관리자 지정)
password_hash       -- 비밀번호 (현재 없음)
registration_ip     -- 가입 시 IP
virtual_account_bank -- 가상계좌 은행
virtual_account_number -- 가상계좌 번호
total_deposit       -- 총 입금액 (캐시)
total_withdrawal    -- 총 출금액 (캐시)
total_bet           -- 총 베팅액 (캐시)
total_win           -- 총 당첨액 (캐시)
login_count         -- 총 로그인 횟수
last_deposit_at     -- 마지막 충전일
last_bet_at         -- 마지막 베팅일
```

## 6. 컬러 시스템

- **Blue**: 정상/긍정 상태 (활성, 승인, 지급)
- **Red**: 부정/주의 상태 (정지, 회수, 거부)

## 7. 완료 체크 프로토콜

> 각 Step 완료 시 반드시:
> 1. ✅ 검증 체크리스트 모든 항목 통과
> 2. ✅ 이 문서의 해당 Step ⬜ → ✅ 변경
> 3. ✅ CLAUDE.md 진행 상황 업데이트
> 4. ✅ 서비스 재시작 후 정상 동작 확인
